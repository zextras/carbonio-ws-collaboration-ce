# SPDX-FileCopyrightText: 2023 Zextras <https://www.zextras.com>
#
# SPDX-License-Identifier: AGPL-3.0-only

openapi: 3.0.3
info:
  title: Zextras Carbonio Workstream Collaboration CE Meeting Api
  description: Zextras Carbonio Workstream Collaboration CE Meeting HTTP APIs definition.
  version: 0.3.2
  contact:
    email: smokybeans@zextras.com
servers:
  - url: http://localhost:10000
tags:
  - name: Meetings
paths:
  /meetings:
    get:
      tags:
        - Meetings
      summary: Retrieves a list of every meeting the user has access to
      operationId: listMeeting
      responses:
        200:
          $ref: '#/components/responses/200ListMeetingResponse'
  /meetings/{meetingId}:
    get:
      tags:
        - Meetings
      summary: Retrieves the requested meeting
      operationId: getMeeting
      parameters:
        - $ref: '#/components/parameters/pathMeetingId'
      responses:
        200:
          $ref: '#/components/responses/200GetMeetingResponse'
        401:
          $ref: '#/components/responses/401UnauthorizedResponse'
        403:
          $ref: '#/components/responses/403ForbiddenResponse'
        404:
          $ref: '#/components/responses/404NotFoundResponse'
    delete:
      tags:
        - Meetings
      summary: Deletes the requested meeting
      operationId: deleteMeeting
      parameters:
        - $ref: '#/components/parameters/pathMeetingId'
      responses:
        204:
          $ref: '#/components/responses/204DeleteMeetingResponse'
        401:
          $ref: '#/components/responses/401UnauthorizedResponse'
        403:
          $ref: '#/components/responses/403ForbiddenResponse'
        404:
          $ref: '#/components/responses/404NotFoundResponse'
  /meetings/{meetingId}/join:
    put:
      tags:
        - Meetings
      summary: adds the current user to the specified meeting
      operationId: joinMeeting
      parameters:
        - $ref: '#/components/parameters/pathMeetingId'
      requestBody:
        $ref: '#/components/requestBodies/JoinMeetingRequest'
      responses:
        204:
          $ref: '#/components/responses/204JoinMeetingResponse'
        401:
          $ref: '#/components/responses/401UnauthorizedResponse'
        403:
          $ref: '#/components/responses/403ForbiddenResponse'
        404:
          $ref: '#/components/responses/404NotFoundResponse'
  /meetings/{meetingId}/leave:
    put:
      tags:
        - Meetings
      summary: remove the current user to the specified meeting
      operationId: leaveMeeting
      parameters:
        - $ref: '#/components/parameters/pathMeetingId'
      responses:
        204:
          $ref: '#/components/responses/204LeaveMeetingResponse'
        401:
          $ref: '#/components/responses/401UnauthorizedResponse'
        403:
          $ref: '#/components/responses/403ForbiddenResponse'
        404:
          $ref: '#/components/responses/404NotFoundResponse'
  /meetings/{meetingId}/sessions/{sessionId}/video:
    put:
      tags:
        - Meetings
      summary: update video stream status for the current session
      operationId: updateVideoStream
      parameters:
        - $ref: '#/components/parameters/pathMeetingId'
        - $ref: '#/components/parameters/pathSessionId'
      requestBody:
        $ref: '#/components/requestBodies/UpdateVideoStreamRequest'
      responses:
        204:
          $ref: '#/components/responses/204VideoStreamResponse'
        401:
          $ref: '#/components/responses/401UnauthorizedResponse'
        403:
          $ref: '#/components/responses/403ForbiddenResponse'
        404:
          $ref: '#/components/responses/404NotFoundResponse'
  /meetings/{meetingId}/sessions/{sessionId}/audio:
    put:
      tags:
        - Meetings
      summary: update audio stream status for the current session
      operationId: updateAudioStream
      parameters:
        - $ref: '#/components/parameters/pathMeetingId'
        - $ref: '#/components/parameters/pathSessionId'
      requestBody:
        $ref: '#/components/requestBodies/UpdateAudioStreamRequest'
      responses:
        204:
          $ref: '#/components/responses/204AudioStreamResponse'
        401:
          $ref: '#/components/responses/401UnauthorizedResponse'
        403:
          $ref: '#/components/responses/403ForbiddenResponse'
        404:
          $ref: '#/components/responses/404NotFoundResponse'
  /meetings/{meetingId}/sessions/{sessionId}/screen:
    put:
      tags:
        - Meetings
      summary: update screen stream status for the current session
      operationId: updateScreenStream
      parameters:
        - $ref: '#/components/parameters/pathMeetingId'
        - $ref: '#/components/parameters/pathSessionId'
      requestBody:
        $ref: '#/components/requestBodies/UpdateScreenStreamRequest'
      responses:
        204:
          $ref: '#/components/responses/204ScreenStreamResponse'
        401:
          $ref: '#/components/responses/401UnauthorizedResponse'
        403:
          $ref: '#/components/responses/403ForbiddenResponse'
        404:
          $ref: '#/components/responses/404NotFoundResponse'

components:
  parameters:
    pathMeetingId:
      in: path
      name: meetingId
      description: meeting identifier
      schema:
        type: string
        format: uuid
      required: true
      allowEmptyValue: false
    pathSessionId:
      in: path
      name: sessionId
      description: session identifier
      schema:
        type: string
      required: true
      allowEmptyValue: false

  requestBodies:
    JoinMeetingRequest:
      description: user request containing its streams settings to join a meeting
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/JoinSettings'
    UpdateVideoStreamRequest:
      description: user request to update a meeting stream status
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/VideoStreamSettings'
    UpdateAudioStreamRequest:
      description: user request to update a meeting stream status
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AudioStreamSettings'
    UpdateScreenStreamRequest:
      description: user request to update a meeting stream status
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ScreenStreamSettings'

  responses:
    200ListMeetingResponse:
      description: List of every meeting that the user has access to
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/Meeting'
    200GetMeetingResponse:
      description: Gets the requested meeting data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Meeting'
    201CreateMeetingResponse:
      description: Meeting was created successfully
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Meeting'
    204DeleteMeetingResponse:
      description: The meeting was deleted successfully
    204JoinMeetingResponse:
      description: The user joined the meeting successfully
    204LeaveMeetingResponse:
      description: The user exited the meeting successfully
    204AudioStreamResponse:
      description: The status of audio stream changed successfully
    204VideoStreamResponse:
      description: The status of video stream changed successfully
    204ScreenStreamResponse:
      description: The status of screen stream changed successfully

    400BadRequestResponse:
      description: The request had wrong or missing parameters
    401UnauthorizedResponse:
      description: User not authorized
    403ForbiddenResponse:
      description: The requester could not access the resource
    404NotFoundResponse:
      description: The requested resource was not found
    409Conflict:
      description: The request conflict with the current state

  schemas:
    Room:
      type: object
      description: Room data for a meeting
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          description: room identifier
        type:
          $ref: "../chats/chats-api.yaml#/components/schemas/RoomType"
        name:
          type: string
          readOnly: true
          description: room name
        description:
          type: string
          description: room description
          readOnly: true
    Participant:
      type: object
      description: Meeting participant data
      properties:
        userId:
          type: string
          format: uuid
          readOnly: true
          description: user identifier
        sessionId:
          type: string
          readOnly: true
          description: VideoServer session id
        audioStreamOn:
          type: boolean
          readOnly: true
          description: indicates if the audio stream is on
        videoStreamOn:
          type: boolean
          readOnly: true
          description: indicates if the video stream is on
        screenStreamOn:
          type: boolean
          readOnly: true
          description: indicates if the screen stream is on
    Meeting:
      type: object
      description: Meeting data
      properties:
        id:
          type: string
          format: uuid
          readOnly: true
          description: meesting identifier
        roomId:
          type: string
          format: uuid
          readOnly: true
          description: meesting identifier
        participants:
          type: array
          items:
            $ref: '#/components/schemas/Participant'
        createdAt:
          type: string
          format: date-time
          readOnly: true
          description: entity creation date
    JoinSettings:
      type: object
      description: user's streams settings to join a meeting
      properties:
        audioStreamEnabled:
          type: boolean
          default: false
          readOnly: true
          description: indicates the audio stream status to join the meeting
        videoStreamEnabled:
          type: boolean
          default: false
          readOnly: true
          description: indicates the video stream status to join the meeting
      required: [ audioStreamEnabled, videoStreamEnabled ]
    VideoStreamSettings:
      type: object
      description: settings to apply on user's video stream
      properties:
        enabled:
          type: boolean
          readOnly: true
          description: indicates the status to change the video stream to
      required: [ enabled ]
    AudioStreamSettings:
      type: object
      description: settings to apply on user's audio stream
      properties:
        enabled:
          type: boolean
          readOnly: true
          description: indicates the status to change the audio stream to
      required: [ enabled ]
    ScreenStreamSettings:
      type: object
      description: settings to apply on user's screen stream
      properties:
        enabled:
          type: boolean
          readOnly: true
          description: indicates the status to change the screen stream to
      required: [ enabled ]